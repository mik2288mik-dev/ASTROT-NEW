/**
 * AI Prompts для Астры
 * 
 * Этот файл содержит все промпты для генерации астрологических интерпретаций
 * через AI (OpenAI, Gemini, Claude и т.д.)
 */

import { NatalChartData, UserProfile } from "../types";

/**
 * Базовый SYSTEM-промпт для Астры (используется везде)
 * 
 * Этот промпт задаёт персонажа. Его передают один раз как system,
 * а дальше уже разные user промпты для задач.
 */
export const SYSTEM_PROMPT_ASTRA = `Ты — Астра, добрый и мудрый астролог, который говорит с человеком простым человеческим языком, без сложного астрологического жаргона.

Твои задачи:
– объяснять натальную карту, прогнозы и любые астрологические темы понятными словами, как близкий друг и проводник;
– давать человеку поддержку, вдохновение и реалистичные советы без запугивания и фатализма;
– говорить на «ты», мягко, уважительно, по-русски, в современном живом стиле;
– опираться на данные карты (положение планет, знаков, домов, аспекты), но не грузить техническими терминами. Если нужно упомянуть астрологию, переводи это на язык жизни: характер, привычки, эмоции, отношения, работа, выборы;
– не использовать сухие формулировки типа «Солнце в 10 доме в квадрате к Сатурну». Вместо этого говори, например: «по характеру ты…», «в работе тебе важно…», «в любви ты проявляешься так…»;
– избегать категоричных обещаний («точно будет», «гарантированно»), говори в формате тенденций и возможностей;
– не давать медицинских, юридических или финансовых диагнозов, только общие эмоциональные и жизненные рекомендации.

Во всех ответах:
– используй тёплый тон, небольшие метафоры, но без эзотерического перегруза;
– делай текст структурированным: короткие абзацы, списки, подзаголовки, если уместно;
– не повторяй дословно входные данные (знаки, градусы и т.п.), а интерпретируй их.`;

/**
 * Промпт для «трёх ключей» (three_keys)
 * 
 * Цель: 3 коротких, плотных, тёплых блока:
 * 1. энергия / личность
 * 2. любовь / отношения
 * 3. карьера / реализация
 */
export const createThreeKeysPrompt = (
  natalData: NatalChartData,
  profile: UserProfile
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  
  return `Вот структурированные астрологические данные человека в формате JSON:

${natalDataJson}

Пояснения к полям (важно для тебя, не для вывода):
– там уже есть информация о положении Солнца, Луны, Асцендента, Венеры, Марса, Юпитера, Сатурна и других планет в знаках и домах, а также аспекты между ними;
– использовать технические обозначения в ответе не нужно, они только для твоей внутренней логики.

Задача: на основе этих данных создай три ключевых блока про человека:

«ТВОЯ ЭНЕРГИЯ» — как проявляется его ядро личности, стиль, жизненная сила.

«ТВОЙ СТИЛЬ ЛЮБВИ» — как он чувствует, любит, строит отношения.

«ТВОЯ КАРЬЕРА И РЕАЛИЗАЦИЯ» — как он проявляется в работе, в достижениях, в самореализации.

Требования к стилю и форме:
– говори на «ты», мягко и поддерживающе;
– никаких фраз типа «Солнце в таком-то доме» или «аспект тригон» — только человеческий язык: характер, склонности, привычки;
– каждый блок:
  – короткий заголовок (ПРОПИСНЫМИ, 2–4 слова),
  – 2–3 абзаца текста (в сумме примерно 400–600 знаков),
  – 2–3 конкретных совета или подсказки в виде списка.

Выведи результат строго в JSON:

{
  "key1": {
    "title": "ТВОЯ ЭНЕРГИЯ",
    "text": "...",
    "advice": ["...", "..."]
  },
  "key2": {
    "title": "ТВОЙ СТИЛЬ ЛЮБВИ",
    "text": "...",
    "advice": ["...", "..."]
  },
  "key3": {
    "title": "ТВОЯ КАРЬЕРА",
    "text": "...",
    "advice": ["...", "..."]
  }
}`;
};

/**
 * Промпт для краткого «паспорт души» / саммари натальной карты
 * 
 * Это то, что видно на первом экране с натальной картой + кнопка «Узнать больше».
 */
export const createSoulPassportPrompt = (
  natalData: NatalChartData,
  profile: UserProfile
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  const userProfileJson = JSON.stringify({
    name: profile.name,
    language: profile.language,
    birthDate: profile.birthDate,
  }, null, 2);
  
  return `Вот астрологические данные человека в JSON:

${natalDataJson}

И дополнительные данные профиля:

${userProfileJson}

(там может быть имя, пол, язык, при желании — возраст/год рождения).

Задача: создай краткое общее описание человека, как если бы ты делала мини-паспорт души.

Формат ответа:

1. Обращение по имени (если есть в данных профиля).

2. 2–3 абзаца общего описания:
   – про характер, энергию, способ воспринимать мир;
   – без лишнего астрологического жаргона.

3. Список из 3–5 «о тебе» — короткие буллеты в формате:
   – «ты легко...»
   – «тебе важно...»
   – «у тебя сильная сторона в том, что...»

Важно:
– не используй такие слова, как «аспект», «квадратура», «тригон», «MC», «диспозитор» и т.п.;
– не перечисляй знаки и дома как сухой набор («Солнце в… Луна в…»), а преврати это в живое описание;
– стиль — тёплый, чуть поэтичный, но без слащавости;
– длина: 800–1200 знаков.

Выведи результат в виде текста (не JSON), который можно сразу показать пользователю.`;
};

/**
 * Промпт для персонального прогноза на день
 */
export const createDailyForecastPrompt = (
  natalData: NatalChartData,
  profile: UserProfile,
  currentDate: string
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  
  return `Сегодня ${currentDate}.

Вот натальная карта человека:

${natalDataJson}

Задача: создай персональный прогноз на сегодня для этого человека.

Учитывай:
– текущие транзиты планет (ты можешь использовать свои знания о текущих астрологических транзитах)
– положение Луны сегодня и её влияние на натальную карту
– общие тенденции дня

Формат ответа должен включать:
– Настроение дня (1-2 слова)
– Краткое описание энергии дня (2-3 абзаца, 300-500 знаков)
– 2-3 конкретных совета на день
– Цвет дня
– Счастливое число

Стиль: тёплый, поддерживающий, без технических терминов. Говори на «ты».

Выведи результат в формате JSON:

{
  "mood": "...",
  "content": "...",
  "advice": ["...", "...", "..."],
  "color": "...",
  "number": 7
}`;
};

/**
 * Промпт для недельного прогноза
 */
export const createWeeklyForecastPrompt = (
  natalData: NatalChartData,
  profile: UserProfile,
  weekRange: string
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  
  return `Период: ${weekRange}

Вот натальная карта человека:

${natalDataJson}

Задача: создай персональный прогноз на неделю для этого человека.

Учитывай:
– транзиты планет на эту неделю
– важные аспекты
– общую тему недели для этого человека

Формат ответа:
– Тема недели (2-4 слова)
– Общий прогноз (2-3 абзаца, 400-600 знаков)
– Совет на неделю
– Фокус в любви
– Фокус в карьере

Стиль: тёплый, вдохновляющий, практичный. Говори на «ты».

Выведи результат в формате JSON:

{
  "theme": "...",
  "advice": "...",
  "love": "...",
  "career": "..."
}`;
};

/**
 * Промпт для месячного прогноза
 */
export const createMonthlyForecastPrompt = (
  natalData: NatalChartData,
  profile: UserProfile,
  month: string
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  
  return `Месяц: ${month}

Вот натальная карта человека:

${natalDataJson}

Задача: создай персональный прогноз на месяц для этого человека.

Учитывай:
– основные транзиты месяца
– ретроградные планеты (если есть)
– фазы Луны
– общую энергию месяца для этого человека

Формат ответа:
– Тема месяца (2-4 слова)
– Главный фокус месяца (1 предложение)
– Развёрнутый прогноз (3-4 абзаца, 600-900 знаков)

Стиль: глубокий, вдохновляющий, с конкретными рекомендациями. Говори на «ты».

Выведи результат в формате JSON:

{
  "theme": "...",
  "focus": "...",
  "content": "..."
}`;
};

/**
 * Промпт для глубокого анализа (Deep Dive) по конкретной теме
 */
export const createDeepDivePrompt = (
  natalData: NatalChartData,
  profile: UserProfile,
  topic: string
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  
  return `Натальная карта человека:

${natalDataJson}

Тема для глубокого анализа: "${topic}"

Задача: создай глубокий персональный анализ по этой теме на основе натальной карты.

Требования:
– анализируй конкретные планеты, знаки и дома, которые относятся к этой теме
– переводи астрологические показатели на язык реальной жизни
– давай конкретные, практичные советы
– объём: 800-1200 знаков
– структура: короткие абзацы или списки

Стиль: глубокий, но понятный. Без технического жаргона. Говори на «ты».

Выведи результат в виде текста (не JSON).`;
};

/**
 * Промпт для совместимости (Синастрия) - КРАТКИЙ РЕЖИМ (бесплатный/тизер)
 * 
 * Это короткий обзор для бесплатных пользователей
 */
export const createBriefSynastryPrompt = (
  natalData1: NatalChartData,
  profile1: UserProfile,
  natalData2: NatalChartData,
  partnerName: string,
  relationshipType: string = 'романтика'
): string => {
  const natalData1Json = JSON.stringify(natalData1, null, 2);
  const natalData2Json = JSON.stringify(natalData2, null, 2);
  
  return `Вот натальная карта первого человека в JSON:

${natalData1Json}

Вот натальная карта второго человека в JSON:

${natalData2Json}

Дополнительные данные (если есть):

{
  "person1": { "name": "${profile1.name}", "role": "он/она/партнёр", "type": "${relationshipType}" },
  "person2": { "name": "${partnerName}", "role": "он/она/партнёр", "type": "${relationshipType}" }
}

Задача: сделай краткий обзор совместимости этих двух людей.

Обязательно учти:
– это не сухая астрология, а живое описание динамики между людьми;
– не используй слова вроде «аспект», «квадратура», «тригон», «седьмой дом» и т.п.;
– опирайся на смыслы: кто что даёт друг другу, где легко, где чувствительно, в чём может быть урок.

Формат ответа:

Короткое вступление: кто кому как ощущается (1 абзац).

2 абзаца:
– что в этой связи гармонично и естественно;
– где могут возникать недопонимания или трение (пиши мягко, без страшилок).

Список из 3–4 подсказок: как лучше обходиться друг с другом, чтобы отношения были в радость.

Говори простым языком, на «ты/вы» в зависимости от формата (можешь обращаться к первому человеку и описывать, как ему лучше взаимодействовать с другим).
Не давай жёстких приговоров, всегда оставляй пространство выбора и роста.

Выведи результат в формате JSON:

{
  "introduction": "...",
  "harmony": "...",
  "challenges": "...",
  "tips": ["...", "...", "..."]
}`;
};

/**
 * Промпт для совместимости (Синастрия) - ПОЛНЫЙ РЕЖИМ (премиум)
 * 
 * Глубокий разбор для премиум пользователей
 */
export const createFullSynastryPrompt = (
  natalData1: NatalChartData,
  profile1: UserProfile,
  natalData2: NatalChartData,
  partnerName: string,
  relationshipType: string = 'романтические отношения'
): string => {
  const natalData1Json = JSON.stringify(natalData1, null, 2);
  const natalData2Json = JSON.stringify(natalData2, null, 2);
  
  return `Вот полные данные натальной карты первого человека (A) в формате JSON:

${natalData1Json}

Вот полные данные натальной карты второго человека (B) в формате JSON:

${natalData2Json}

Дополнительные данные о типе связи:

{
  "relationship_type": "${relationshipType}"
}

где relationship_type может быть, например: "романтические отношения", "брак", "начало общения", "дружба", "деловое партнёрство".

Задача: сделай глубокий разбор совместимости этих двух людей, как опытный астролог, но объясняя всё простым человеческим языком.

Внутри используй все данные карты (характер, эмоции, стиль любви, реакции, потребности, способ действовать), но не проговаривай технические термины типа «аспект», «дом», «оппозиция», «квадратура», «соединение», «управитель» и т.д.

Структура ответа:

## Общая тема вашей связи
– 1–2 абзаца: какую атмосферу создаёт эта пара, чему отношения учат обоих, как они ощущаются «изнутри».

## Что вас притягивает друг к другу
– 2–3 абзаца:
– в чём естественное взаимопонимание;
– какие качества одного дополняют другого;
– как каждый из вас чувствует себя рядом с другим.

## Где могут быть сложности и трения
– 2–3 абзаца, мягко:
– где разный темп, ожидания, способы проявлять чувства;
– какие темы могут вызывать напряжение;
– как это можно проживать экологично, без обвинений.

## Как лучше выстраивать отношения
– 3–6 конкретных рекомендаций в виде списка:
– что помогает вам быть ближе;
– как поддерживать друг друга в трудные моменты;
– чего лучше избегать в общении.

## Потенциал этих отношений
– 1–3 абзаца о том, что хорошего может раскрыться в этой связи, если вы оба немного постараетесь.

Важно:
– не оценивай связь как «хорошая/плохая», говори о потенциалах, уроках и особенностях;
– не используй сложный астрологический язык — ни знаков, ни домов, ни аспектов, только живые описания: характеры, реакции, переживания, сценарии;
– стиль тёплый, поддерживающий, честный, без запугивания и фатализма;
– пиши так, будто говоришь с живыми людьми, которые пришли на консультацию и хотят понять, «что между нами и как нам быть».

Выведи результат в формате JSON:

{
  "generalTheme": "...",
  "attraction": "...",
  "difficulties": "...",
  "recommendations": ["...", "...", "..."],
  "potential": "..."
}`;
};

/**
 * Промпт для совместимости (Синастрия) - СТАРЫЙ ФОРМАТ
 * Оставлен для обратной совместимости
 */
export const createSynastryPrompt = (
  natalData1: NatalChartData,
  profile1: UserProfile,
  natalData2: NatalChartData,
  partnerName: string
): string => {
  const natalData1Json = JSON.stringify(natalData1, null, 2);
  const natalData2Json = JSON.stringify(natalData2, null, 2);
  
  return `Натальная карта ${profile1.name}:

${natalData1Json}

Натальная карта ${partnerName}:

${natalData2Json}

Задача: проанализируй совместимость между этими двумя людьми.

Учитывай:
– совместимость Солнце-Солнце, Луна-Луна
– аспекты между Венерой и Марсом
– совместимость по элементам
– потенциальные точки роста и вызовы

Формат ответа:
– Общий процент совместимости (0-100)
– Эмоциональная связь (2-3 предложения)
– Интеллектуальная связь (2-3 предложения)
– Главный вызов отношений (2-3 предложения)
– Общий вывод (2-3 предложения)

Стиль: честный, но поддерживающий. Без приукрашивания, но и без пессимизма. Говори на «ты».

Выведи результат в формате JSON:

{
  "compatibilityScore": 75,
  "emotionalConnection": "...",
  "intellectualConnection": "...",
  "challenge": "...",
  "summary": "..."
}`;
};

/**
 * Вспомогательная функция для добавления языковой инструкции
 */
export const addLanguageInstruction = (prompt: string, language: 'ru' | 'en'): string => {
  if (language === 'en') {
    return prompt + '\n\n**IMPORTANT: Respond in English only.**';
  }
  return prompt + '\n\n**ВАЖНО: Отвечай только на русском языке.**';
};

/**
 * Промпт для полной интерпретации натальной карты по блокам
 * 
 * Используется когда человек нажимает «Узнать больше» и попадает в подробный разбор.
 */
export const createFullNatalChartPrompt = (
  natalData: NatalChartData,
  profile: UserProfile
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  
  return `Вот полные данные натальной карты человека в JSON:

${natalDataJson}

Задача: на основе этих данных создай структурированную интерпретацию натальной карты.

Разбей текст на блоки с подзаголовками:

«ТВОЯ ЛИЧНОСТЬ И ЭНЕРГИЯ» — про общий характер, темперament, стиль проявления.

«ТВОЙ ВНУТРЕННИЙ МИР И ЭМОЦИИ» — как человек переживает, чувствует, реагирует.

«ТВОЙ УМ И ОБЩЕНИЕ» — как он думает, учится, общается.

«ЛЮБОВЬ И ОТНОШЕНИЯ» — как он любит, что важно в партнёрстве.

«КАРЬЕРА И САМОРАЗВИТИЕ» — работа, цели, успех, самореализация.

«ТВОИ СИЛЬНЫЕ СТОРОНЫ» — список плюсов.

«ЧЕМУ СТОИТ НАУЧИТЬСЯ» — мягко о зонах роста, без осуждения.

Требования:
– в каждом блоке 2–4 абзаца;
– не упоминай технические термины («Солнце в 10 доме», «соединение с Марсом»), только смысл: как человек думает, чувствует, действует;
– можно иногда аккуратно упоминать знак (например: «по-львиному щедрый», «по-девьи внимательный к деталям»), но без сухого перечисления;
– не пиши категоричных приговоров, говори в форме тенденций («тебе свойственно…», «чаще всего ты…», «ты можешь замечать за собой...»).

Выведи текст в формате Markdown: с заголовками ## для блоков и списками там, где уместно.`;
};

/**
 * Промпт для прогнозов с учётом транзитов
 * 
 * Используется для генерации дневного/недельного/месячного прогноза
 * с учётом текущих астрологических влияний
 */
export const createTransitForecastPrompt = (
  natalData: NatalChartData,
  profile: UserProfile,
  transits: any,
  period: 'day' | 'week' | 'month'
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  const transitsJson = JSON.stringify(transits, null, 2);
  
  return `Вот данные натальной карты человека:

${natalDataJson}

А вот текущие астрологические влияния (транзиты) в JSON:

${transitsJson}

Тип прогноза: ${period}
(day = день, week = неделя, month = месяц).

Задача: на основе сочетания натальной карты и текущих влияний создай понятный прогноз для человека.

Требования к стилю:
– никаких сложных астрологических терминов (не использовать слова «транзит», «квадрат», «оппозиция», «аспект» и т.п.);
– говорить о тенденциях и возможностях: настроение, фокус, отношения, работа, внутренняя тема периода;
– обязательно добавить 3–5 практических рекомендаций, что можно сделать в этот период (в виде списка).

Формат:
– для day: 1–2 абзаца общего настроения + список советов;
– для week: 3–4 абзаца (общий фон + работа + отношения + внутреннее состояние) + список советов;
– для month: 4–6 абзацев (тенденции, возможности, что важно не упустить, чему учит период) + список советов.

Всегда сохраняй тёплый, поддерживающий тон и оставляй ощущение, что человек не жертва обстоятельств, а участник процесса.

Выведи результат в формате Markdown с подзаголовками и списками.`;
};

/**
 * Промпт для описания эволюции пользователя
 * 
 * Используется для красивого описания текущего уровня развития
 * с учётом натальной карты и характеристик
 */
export const createEvolutionPrompt = (
  natalData: NatalChartData,
  profile: UserProfile,
  evolution: any
): string => {
  const natalDataJson = JSON.stringify(natalData, null, 2);
  const evolutionJson = JSON.stringify(evolution, null, 2);
  
  return `Вот натальная карта человека:

${natalDataJson}

А вот его текущие условные «характеристики развития» в JSON:

${evolutionJson}

Пример структуры evolution_json:

{
  "level": 2,
  "stats": {
    "awareness": 50,
    "intuition": 52,
    "confidence": 52
  },
  "title": "Apprentice"
}

Задача: на основе уровня и натальной карты опиши, на каком внутреннем этапе сейчас находится человек.

Формат текста:
– короткий заголовок уровня (можно оставить «Apprentice», но поясни по-русски, что это значит);
– 1–2 абзаца описания: что он уже в себе развил, чему учится сейчас;
– по каждому показателю (awareness, intuition, confidence) дай по 1–2 предложения с пояснением, как это проявляется в жизни;
– в конце — 3 мягких рекомендации «как расти дальше».

Не используй сложных астрологических терминов, говори как наставник, который видит путь человека и аккуратно подсказывает.

Выведи результат в формате Markdown с подзаголовками.`;
};

/**
 * Типы для структурированных ответов AI
 */
export interface ThreeKeysAIResponse {
  key1: {
    title: string;
    text: string;
    advice: string[];
  };
  key2: {
    title: string;
    text: string;
    advice: string[];
  };
  key3: {
    title: string;
    text: string;
    advice: string[];
  };
}

export interface DailyForecastAIResponse {
  mood: string;
  content: string;
  advice: string[];
  color: string;
  number: number;
}

export interface WeeklyForecastAIResponse {
  theme: string;
  advice: string;
  love: string;
  career: string;
}

export interface MonthlyForecastAIResponse {
  theme: string;
  focus: string;
  content: string;
}

export interface SynastryAIResponse {
  compatibilityScore: number;
  emotionalConnection: string;
  intellectualConnection: string;
  challenge: string;
  summary: string;
}

export interface BriefSynastryAIResponse {
  introduction: string;
  harmony: string;
  challenges: string;
  tips: string[];
}

export interface FullSynastryAIResponse {
  generalTheme: string;
  attraction: string;
  difficulties: string;
  recommendations: string[];
  potential: string;
}
