# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –≤ –ë–î —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É".

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`:
- `three_keys_text` (JSONB) - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∏ –∫–ª—é—á–∞
- `three_keys_updated_at` (TIMESTAMP) - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `natal_summary` (TEXT) - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `natal_summary_updated_at` (TIMESTAMP)
- `full_natal` (TEXT) - –ø–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∫–∞—Ä—Ç—ã
- `full_natal_updated_at` (TIMESTAMP)
- `stars_balance` (INTEGER) - –±–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–π

#### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `synastry_cache`:
- –•—Ä–∞–Ω–∏—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–Ω–∞—Å—Ç—Ä–∏–∏ (–∫—Ä–∞—Ç–∫–∏–µ –∏ –ø–æ–ª–Ω—ã–µ)
- –°–≤—è–∑–∞–Ω–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–æ `user_id`
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —á–µ—Ä–µ–∑ `partner_data` (JSONB)

#### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `forecasts_cache`:
- –•—Ä–∞–Ω–∏—Ç –ø—Ä–æ–≥–Ω–æ–∑—ã (–¥–µ–Ω—å/–Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü)
- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è: `user_id` + `period_type` + `period_date`

#### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `regenerations`:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç: –¥–∞—Ç—É, —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –±—ã–ª –ª–∏ –ø–ª–∞—Ç—ë–∂, —Å—Ç–æ–∏–º–æ—Å—Ç—å

### 2. API Endpoints

#### `GET /api/astrology/three-keys` (–æ–±–Ω–æ–≤–ª—ë–Ω)
**–õ–æ–≥–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –ë–î
2. –ï—Å–ª–∏ –µ—Å—Ç—å - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–µ—à (–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–Ω–æ–≤–æ!)
3. –ï—Å–ª–∏ –Ω–µ—Ç - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ OpenAI + —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

#### `POST /api/astrology/regenerate` (–Ω–æ–≤—ã–π)
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π endpoint –¥–ª—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª—é–±—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã: `three_keys`, `natal_summary`, `full_natal`
- –õ–æ–≥–∏–∫–∞ –ª–∏–º–∏—Ç–æ–≤:
  - –ü–µ—Ä–≤–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ –¥–µ–Ω—å - **–±–µ—Å–ø–ª–∞—Ç–Ω–∞**
  - –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ - **50 –∑–≤—ë–∑–¥**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞
- –°–ø–∏—Å–∞–Ω–∏–µ –∑–≤—ë–∑–¥ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 3. UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `RegenerateButton` (`/components/RegenerateButton.tsx`)
**–°–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏:**
- `idle` - –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è
- `loading` - –∏–¥—ë—Ç —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–∞–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è)
- `success` - —É—Å–ø–µ—à–Ω–æ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ
- `error` - –æ—à–∏–±–∫–∞
- `limit_reached` - –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

**–î–ª—è –Ω–µ-–ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–º–æ—á–µ–∫ üîí
- –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Paywall

**Tooltip:**
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏: "–ü–µ—Ä–≤–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–∞ üí´"
- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π: "–°–ª–µ–¥—É—é—â–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è - 50 –∑–≤—ë–∑–¥ ‚≠ê"
- –ü—Ä–∏ –ª–∏–º–∏—Ç–µ: "–ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∑–∞–≤—Ç—Ä–∞ üåó"

#### `TextCard` –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (`/components/TextCard.tsx`)
**–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤:**
- `TextCard` - –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, –∏–∫–æ–Ω–∫–æ–π, –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- `TextContent` - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
- `AdviceList` - –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ–≤–µ—Ç–æ–≤
- `NumberedList` - –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
- `Paragraph` - –ø–∞—Ä–∞–≥—Ä–∞—Ñ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
- `SectionTitle` - –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏

**–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Å—Ç–∏–ª—å:**
- –°–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã (rounded-2xl)
- –ú—è–≥–∫–∏–µ —Ç–µ–Ω–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
- –ß–∏—Ç–∞–±–µ–ª—å–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞

### 4. –ü—Ä–æ–º–ø—Ç—ã OpenAI

–í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ–∫—Å—Ç–∞–º:**
- –ö–æ—Ä–æ—Ç–∫–∏–µ –∞–±–∑–∞—Ü—ã (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, 150-200 –∑–Ω–∞–∫–æ–≤)
- –ë–µ–∑ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∂–∞—Ä–≥–æ–Ω–∞
- –ü—Ä–æ—Å—Ç–æ–π, —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —è–∑—ã–∫
- –°–ø–∏—Å–∫–∏ –¥–ª—è —Å–æ–≤–µ—Ç–æ–≤/—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –ú–µ–∂–¥—É –∞–±–∑–∞—Ü–∞–º–∏ - –ø–∞—É–∑—ã –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ view-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `NatalChart.tsx` (–æ–±–Ω–æ–≤–ª—ë–Ω)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `TextCard` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä—ë—Ö –∫–ª—é—á–µ–π
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ `RegenerateButton`
- –ü—Ä–∏ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π state —á–µ—Ä–µ–∑ `setKeys()`

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω —Å –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ë–î - –∫–µ—à–∞ –Ω–µ—Ç
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ OpenAI
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞—Ö–æ–¥
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ë–î - –∫–µ—à –µ—Å—Ç—å!
3. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç** (–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–Ω–æ–≤–æ)
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–ø—Ä–µ–º–∏—É–º, –ø–µ—Ä–≤—ã–π —Ä–∞–∑ —Å–µ–≥–æ–¥–Ω—è)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É"
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã - —ç—Ç–æ –ø–µ—Ä–≤–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–≥–æ–¥–Ω—è
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
4. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ë–î
5. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `regenerations`
6. –û–±–Ω–æ–≤–ª—è–µ—Ç UI

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–ø—Ä–µ–º–∏—É–º, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É" –≤—Ç–æ—Ä–æ–π —Ä–∞–∑
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã - —É–∂–µ –±—ã–ª–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–≥–æ–¥–Ω—è
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥ (–Ω—É–∂–Ω–æ 50)
4. –°–ø–∏—Å—ã–≤–∞–µ—Ç 50 –∑–≤—ë–∑–¥
5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç
6. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ë–î
7. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É –≤ `regenerations`
8. –û–±–Ω–æ–≤–ª—è–µ—Ç UI –∏ –±–∞–ª–∞–Ω—Å

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É"
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å - –º–µ–Ω—å—à–µ 50 –∑–≤—ë–∑–¥
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
4. –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
5. –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ idle

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `REGENERATION_COST_STARS = 50` –≤ —Ñ–∞–π–ª–µ:
- `/pages/api/astrology/regenerate.ts`

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```typescript
type ContentType = 'three_keys' | 'natal_summary' | 'full_natal' | 'synastry' | 'forecast';
```

## Database Helper (`/lib/db.ts`)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

### `db.cachedTexts.*`
- `getThreeKeys(userId)` - –ø–æ–ª—É—á–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∏ –∫–ª—é—á–∞
- `setThreeKeys(userId, data)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–∏ –∫–ª—é—á–∞
- `getNatalSummary(userId)` - –ø–æ–ª—É—á–∏—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `setNatalSummary(userId, data)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `getFullNatal(userId)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä
- `setFullNatal(userId, data)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä

### `db.synastryCache.*`
- `get(userId, partnerData)` - –ø–æ–ª—É—á–∏—Ç—å —Å–∏–Ω–∞—Å—Ç—Ä–∏—é
- `set(userId, partnerData, briefAnalysis, fullAnalysis)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å

### `db.forecastsCache.*`
- `get(userId, periodType, periodDate)` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑
- `set(userId, periodType, periodDate, content)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å

### `db.regenerations.*`
- `getCountToday(userId, contentType)` - —Å–∫–æ–ª—å–∫–æ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å–µ–≥–æ–¥–Ω—è
- `add(userId, contentType, wasPaid, starsCost)` - –∑–∞–ø–∏—Å–∞—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é

### `db.starsBalance.*`
- `get(userId)` - –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥
- `add(userId, amount)` - –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—ë–∑–¥—ã
- `deduct(userId, amount)` - —Å–ø–∏—Å–∞—Ç—å –∑–≤—ë–∑–¥—ã (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π)

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ:
- `004_add_cached_texts` - –ø–æ–ª—è –≤ users
- `005_create_synastry_cache` - —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–Ω–∞—Å—Ç—Ä–∏–π
- `006_create_forecasts_cache` - —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- `007_create_regenerations_tracking` - —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–π

## –¢–∏–ø—ã TypeScript (`/types.ts`)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–∏–ø—ã:

```typescript
interface CachedText<T = any> {
  data: T;
  updatedAt?: Date | string;
  createdAt?: Date | string;
}

type ContentType = 'three_keys' | 'natal_summary' | 'full_natal' | 'synastry' | 'forecast';

interface RegenerationLimits {
  canRegenerate: boolean;
  isFree: boolean;
  costInStars: number;
  regenerationsToday: number;
  message?: string;
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ OpenAI**: —Ç–µ–∫—Å—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
2. **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –æ—Ç–¥–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
3. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞—Ö–æ–¥–∞—Ö
4. **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è**: –ø–ª–∞—Ç–Ω—ã–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–≤—ë–∑–¥—ã
5. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π UI**: –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –≤ –µ–¥–∏–Ω–æ–º —Å—Ç–∏–ª–µ
6. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ**: –≤—Å–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –ë–î

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å

1. ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å —Å—Ö–µ–º—É –ë–î
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã TypeScript
4. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å API endpoints –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å API —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
6. ‚úÖ –°–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏
7. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
8. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã
9. üîÑ –û–±–Ω–æ–≤–∏—Ç—å view –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—á–∞—Å—Ç–∏—á–Ω–æ - NatalChart)
10. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### TODO:
- –û–±–Ω–æ–≤–∏—Ç—å `Synastry.tsx` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –û–±–Ω–æ–≤–∏—Ç—å endpoints –¥–ª—è forecasts (daily/weekly/monthly)
- –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è —Å–∏–Ω–∞—Å—Ç—Ä–∏–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:

```tsx
import { RegenerateButton } from '../components/RegenerateButton';
import { TextCard, TextContent, AdviceList } from '../components/TextCard';

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
const [content, setContent] = useState(initialContent);

<TextCard
  title="–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è"
  icon="‚ö°"
  variant="highlight"
  footer={
    <RegenerateButton
      userId={profile.id}
      contentType="three_keys"
      isPremium={profile.isPremium}
      language={profile.language}
      profile={profile}
      chartData={chartData}
      onRegenerate={(newData) => setContent(newData)}
      onRequestPremium={handlePremiumRequest}
    />
  }
>
  <TextContent>
    <Paragraph>{content.text}</Paragraph>
  </TextContent>
  <AdviceList items={content.advice} />
</TextCard>
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞: **01.12.2025**
