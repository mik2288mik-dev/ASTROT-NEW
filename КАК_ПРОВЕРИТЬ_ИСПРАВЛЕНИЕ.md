# Как проверить исправление определения знака зодиака

## Что было исправлено

✅ **Проблема**: Неправильное определение знака зодиака из-за некорректной обработки часовых поясов  
✅ **Решение**: Добавлен автоматический расчет часового пояса по координатам места рождения

---

## Быстрая проверка

### 1. Откройте приложение
Запустите приложение и пройдите процесс онбординга с вашими реальными данными:
- Имя
- Дата рождения
- Время рождения (важно!)
- Место рождения

### 2. Проверьте знак зодиака
После расчета натальной карты проверьте:
- Знак Солнца должен соответствовать вашему реальному знаку
- Знак Луны
- Восходящий знак (Ascendant)

### 3. Проверьте логи в консоли

**Откройте консоль браузера** (нажмите F12 или Cmd+Option+I на Mac):

#### Вы должны увидеть:

```
[SwissephCalculator-WASM] Calculated Julian Day with timezone correction
{
  inputDate: "1990-08-15"
  inputTime: "12:0"
  coordinates: {lat: 55.7558, lon: 37.6173}
  timezoneOffsetHours: "2.51"
  localTime: "12.0000"
  utcTime: "9.4885"
  ...
}
```

#### Затем расчет планет:

```
[SwissephCalculator-WASM] [PLANET] Calculated Sun
{
  longitude: "142.3456"
  sign: "Leo"
  degreeInSign: "22.35"
  fullDegree: "22.35° Leo"
}
```

#### И валидацию:

```
[VALIDATION] ✓ Sun sign matches expected value for date
```

или (для граничных случаев):

```
[VALIDATION] ⚠️ Sun sign mismatch detected!
{
  calculated: "Virgo"
  expectedByDate: "Leo"
  ...
}
```

---

## Тестовые случаи

### Случай 1: Явный знак (середина периода)
**Данные**:
- Дата: 15 августа 1990
- Время: 12:00
- Место: Москва, Россия

**Ожидаемый результат**: Лев ♌

---

### Случай 2: Граничный случай
**Данные**:
- Дата: 23 августа 1990
- Время: 02:30
- Место: Москва, Россия

**Ожидаемый результат**: Лев ♌ или Дева ♍ (зависит от точного времени перехода в этом году)

**Важно**: На границе знаков время рождения критично важно!

---

### Случай 3: Зимний знак
**Данные**:
- Дата: 25 декабря 2000
- Время: 00:00
- Место: Лондон, Великобритания

**Ожидаемый результат**: Козерог ♑

---

### Случай 4: Весенний знак
**Данные**:
- Дата: 21 марта 1985
- Время: 12:00
- Место: Нью-Йорк, США

**Ожидаемый результат**: Овен ♈ (день весеннего равноденствия)

---

## Что проверять

### ✅ Правильно работает:

1. **Знак Солнца соответствует дате рождения**
   - Для большинства случаев (не на границе) знак должен совпадать с ожидаемым

2. **Учитывается часовой пояс**
   - В логах должен быть `timezoneOffsetHours` (примерное смещение)

3. **Время конвертируется в UTC**
   - `localTime` → `utcTime` с учетом смещения

4. **Координаты определяются правильно**
   - Для известных городов координаты должны быть корректными

### ⚠️ Нормальные предупреждения:

1. **"Sun sign mismatch" для граничных дат**
   - Например, 22-23 числа каждого месяца
   - Это нормально! Упрощенная валидация не учитывает точное время

2. **Небольшое расхождение для утренних/ночных рождений**
   - Для людей, родившихся рано утром или поздно вечером на границе знаков

---

## Если что-то не так

### Проблема: Знак все еще неправильный

1. **Проверьте данные**:
   - Правильно ли указано время рождения?
   - Правильно ли указано место рождения?

2. **Проверьте логи**:
   - Есть ли сообщение о расчете Julian Day?
   - Какое значение `timezoneOffsetHours`?
   - Какая эклиптическая долгота Солнца (`longitude`)?

3. **Проверьте координаты**:
   - Правильно ли определились координаты города?
   - Проверьте лог `Getting coordinates for place`

### Проблема: В консоли ошибки

1. **"Failed to initialize Swiss Ephemeris"**
   - Проверьте подключение к интернету (библиотека загружает данные)
   - Перезагрузите страницу

2. **"Location not found"**
   - Укажите место рождения более точно (например, "Москва, Россия" вместо просто "Москва")

3. **Другие ошибки**
   - Скопируйте текст ошибки и отправьте разработчику

---

## Дополнительная информация

### О тропическом зодиаке

Приложение использует **тропический зодиак** (западная астрология):
- Знаки привязаны к сезонам, а не к созвездиям
- Овен начинается в день весеннего равноденствия (~21 марта)
- Это стандарт для большинства западных астрологов

Если вы привыкли к **сидерическому зодиаку** (ведическая астрология), ваш знак может отличаться примерно на 23-24°.

### О точности времени

Если вы не знаете точное время рождения:
- Используется 12:00 по умолчанию
- Знак Солнца обычно правильный (за исключением граничных случаев)
- Восходящий знак (Ascendant) может быть неточным

Для самой точной карты нужно **точное время рождения до минуты**.

---

**Версия документа**: 1.0  
**Дата**: 2 декабря 2025
